<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Anagramas – versión limpia</title>
<style>
  :root{
    --bg:#0f141b; --panel:#121a23; --muted:#9fb3c9; --tile:#0e1520;
    --grid:rgba(230,238,247,.12); --accent:#6ab0ff;
    --ok:#2ecc71; --warn:#ffb74d; --bad:#ff6b6b; --neutral:#90a4b6;
  }
  html,body{
    height:100%; margin:0;
    background:var(--bg); color:#e6eef7;
    font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  }
  .wrap{max-width:980px;margin:0 auto;padding:18px}
  h1{font-size:20px;margin:0 0 10px}
  .section{
    background:var(--panel); border:1px solid var(--grid);
    border-radius:12px; padding:14px; margin-top:14px;
  }
  .letter-group{
    display:flex; justify-content:center; flex-wrap:wrap; gap:6px;
    font-family:monospace; font-size:22px; margin:4px 0;
  }
  .vocal{color:#6ab0ff}
  .cons{color:#ffb74d}
  .letters-block{display:flex;flex-direction:column;align-items:center;margin-top:8px}

  .chips{
    display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; font-size:13px;
  }
  .chip{
    background:var(--tile); border:1px solid var(--grid);
    padding:6px 10px; border-radius:999px;
  }
  .ok{color:#bff4d2;border-color:rgba(46,204,113,.3);background:rgba(46,204,113,.12)}
  .warn{color:#ffd9a6;border-color:rgba(255,183,77,.35);background:rgba(255,183,77,.12)}
  .bad{color:#ffc7c7;border-color:rgba(255,107,107,.35);background:rgba(255,107,107,.12)}

  .progress{
    height:10px;background:#0b1118;border:1px solid var(--grid);
    border-radius:999px;overflow:hidden;margin-top:10px;
  }
  .bar{height:100%;background:var(--accent);width:0%}

  /* Overlay del editor */
  .editor-wrap{position:relative}
  .highlight, .editor{
    font:16px/1.5 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    white-space:pre-wrap; word-break:break-word;
    padding:12px; border-radius:10px; border:1px solid var(--grid);
    background:var(--tile); min-height:110px;
  }
  .highlight{color:transparent; pointer-events:none}
  .editor{
    position:absolute; inset:0; background:transparent; color:transparent;
    caret-color:#e6eef7; outline:none; resize:vertical;
  }
  .hl-ok{color:#9be7b0}
  .hl-warn{color:#ffd79a}
  .hl-bad{color:#ff9a9a}
  .hl-neutral{color:#7f93a6}
</style>
</head>
<body>
<div class="wrap">
  <h1>Anagramas – versión limpia</h1>

  <div class="section">
    <textarea id="base" rows="2" placeholder="Escribe aquí tu nombre o frase base..." class="highlight" style="position:static;color:#e6eef7;background:var(--tile)"></textarea>

    <div class="letters-block">
      <div id="vocales" class="letter-group"></div>
      <div id="consonantes" class="letter-group"></div>
    </div>
  </div>

  <div class="section">
    <div class="editor-wrap">
      <div id="highlight" class="highlight"></div>
      <textarea id="editor" class="editor" placeholder="Escribe tu frase o anagrama candidato..."></textarea>
    </div>

    <div class="progress"><div id="bar" class="bar"></div></div>
    <div class="chips" id="status"></div>
  </div>
</div>

<script>
const vowels = new Set(['a','e','i','o','u']);
const baseEl = document.getElementById('base');
const vocalesEl = document.getElementById('vocales');
const consonantesEl = document.getElementById('consonantes');
const editor = document.getElementById('editor');
const highlight = document.getElementById('highlight');
const bar = document.getElementById('bar');
const status = document.getElementById('status');

const esc = s => s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
function normalize(str){return str.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/ñ/g,'n');}
function lettersOnly(str){return normalize(str).replace(/[^a-z]/g,'');}
function countMap(str){const m={};for(const ch of lettersOnly(str))m[ch]=(m[ch]||0)+1;return m;}

function renderGroups(baseCounts,phraseCounts){
  const remaining={};
  for(const [ch,need] of Object.entries(baseCounts)){
    const used=Math.min(need,phraseCounts[ch]||0);
    remaining[ch]=Math.max(0,need-used);
  }
  const voc=[],cons=[];
  for(const [ch,count] of Object.entries(remaining)){
    for(let i=0;i<count;i++)(vowels.has(ch)?voc:cons).push(ch);
  }
  voc.sort(); cons.sort();
  vocalesEl.innerHTML=voc.map(l=>`<span class="vocal">${l.toUpperCase()}</span>`).join('');
  consonantesEl.innerHTML=cons.map(l=>`<span class="cons">${l.toUpperCase()}</span>`).join('');
}

function renderHighlight(){
  const baseCounts=countMap(baseEl.value);
  const phraseCounts=countMap(editor.value);
  const used={}; let out='';
  for(const raw of editor.value){
    const n=normalize(raw);
    if(!/^[a-z]$/.test(n)){out+=`<span class="hl-neutral">${esc(raw)}</span>`;continue;}
    const need=baseCounts[n]||0; const have=used[n]||0;
    if(!need){out+=`<span class="hl-bad">${esc(raw)}</span>`;}
    else if(have<need){used[n]=have+1;out+=`<span class="hl-ok">${esc(raw)}</span>`;}
    else{out+=`<span class="hl-warn">${esc(raw)}</span>`;}
  }
  highlight.innerHTML=out;

  const totalBase=Object.values(baseCounts).reduce((a,b)=>a+b,0);
  let usedCount=0; const missing=[],over=[],notIn=[];
  for(const [ch,need] of Object.entries(baseCounts)){
    const have=phraseCounts[ch]||0; usedCount+=Math.min(need,have);
    if(have<need) missing.push(`${ch.toUpperCase()}×${need-have}`);
  }
  for(const [ch,have] of Object.entries(phraseCounts)){
    const need=baseCounts[ch]||0;
    if(need===0) notIn.push(`${ch.toUpperCase()}×${have}`);
    else if(have>need) over.push(`${ch.toUpperCase()}×${have-need}`);
  }
  const pct=totalBase?Math.round(usedCount/totalBase*100):0;
  bar.style.width=pct+'%';
  status.innerHTML='';
  if(missing.length)status.innerHTML+=`<span class="chip warn">Faltan ${missing.join(', ')}</span>`;
  if(over.length)status.innerHTML+=`<span class="chip bad">De más ${over.join(', ')}</span>`;
  if(notIn.length)status.innerHTML+=`<span class="chip bad">No permitidas ${notIn.join(', ')}</span>`;
  if(!missing.length&&!over.length&&!notIn.length&&lettersOnly(editor.value).length===totalBase)
    status.innerHTML=`<span class="chip ok">¡Anagrama perfecto!</span>`;
  renderGroups(baseCounts,phraseCounts);
}

baseEl.addEventListener('input',renderHighlight);
editor.addEventListener('input',renderHighlight);
renderHighlight();
</script>
</body>
</html>
